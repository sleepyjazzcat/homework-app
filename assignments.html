<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>Your Assignments</title>
    <link href="https://fonts.googleapis.com" rel="preconnect"/>
    <link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
    <link href="https://fonts.googleapis.com/css2?family=Lexend:wght@400;500;700&amp;display=swap" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet"/>
    <script src="https://cdn.tailwindcss.com?plugins=forms"></script>
    <script>
        // Tailwind Configuration
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#137fec",
                        "background-light": "#f6f7f8",
                        "background-dark": "#101922",
                        "card-light": "#ffffff",
                        "card-dark": "#1b2734",
                        "accent-red": "#ef4444",
                        "accent-green": "#10b981",
                        "accent-blue": "#3b82f6",
                    },
                    fontFamily: {
                        "display": ["Lexend", "sans-serif"]
                    },
                    borderRadius: {
                        "DEFAULT": "0.25rem",
                        "lg": "0.5rem",
                        "xl": "0.75rem",
                        "full": "9999px"
                    },
                },
            },
        }
    </script>
    <style>
        body {
            min-height: 100dvh;
        }
        .material-symbols-outlined {
            font-variation-settings:
            'FILL' 0,
            'wght' 400,
            'GRAD' 0,
            'opsz' 24
        }
        /* Custom scrollbar style for better aesthetics */
        main::-webkit-scrollbar {
            width: 8px;
        }
        main::-webkit-scrollbar-track {
            background: theme('colors.background-light');
        }
        main::-webkit-scrollbar-thumb {
            background: theme('colors.primary');
            border-radius: 4px;
        }
        .task-checkbox:checked + .task-label {
            text-decoration: line-through;
            color: theme('colors.slate.400');
        }
    </style>
</head>
<body class="bg-background-light dark:bg-background-dark font-display text-slate-800 dark:text-slate-200 flex flex-col min-h-screen">

    <!-- Confirmation Modal (Hidden by default) -->
    <div id="confirmation-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden items-center justify-center p-4">
        <div class="bg-card-light dark:bg-card-dark rounded-xl p-6 shadow-2xl w-full max-w-sm">
            <h3 class="text-lg font-bold mb-3">Confirm Deletion</h3>
            <p id="modal-text" class="text-sm text-slate-600 dark:text-slate-300 mb-6">Are you sure you want to delete this assignment?</p>
            <div class="flex justify-end space-x-3">
                <button id="modal-cancel" class="px-4 py-2 text-sm font-medium rounded-lg bg-slate-200 dark:bg-slate-700 hover:bg-slate-300 dark:hover:bg-slate-600">Cancel</button>
                <button id="modal-confirm" class="px-4 py-2 text-sm font-medium rounded-lg bg-accent-red text-white hover:bg-red-600">Delete</button>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="bg-card-light dark:bg-card-dark sticky top-0 z-10 shadow-md border-b border-slate-200 dark:border-slate-700">
        <div class="p-4 flex items-center justify-between">
            <h1 class="text-xl font-bold text-slate-900 dark:text-white">Assignments</h1>
            <a href="add-assignments.html" class="p-2 text-primary hover:bg-slate-100 dark:hover:bg-slate-700 rounded-full transition-colors">
                <span class="material-symbols-outlined text-2xl">add_circle</span>
            </a>
        </div>
        <!-- Filter Tabs -->
        <div class="flex justify-center border-t border-slate-200 dark:border-slate-700 p-2 space-x-2">
            <button data-filter="all" class="filter-button px-4 py-1.5 text-sm font-medium rounded-full bg-primary text-white transition-colors">All</button>
            <button data-filter="upcoming" class="filter-button px-4 py-1.5 text-sm font-medium rounded-full text-slate-600 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-700 transition-colors">Upcoming</button>
            <button data-filter="completed" class="filter-button px-4 py-1.5 text-sm font-medium rounded-full text-slate-600 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-700 transition-colors">Completed</button>
        </div>
    </header>

    <!-- Message Box for Feedback -->
    <div id="message-box" class="mx-4 mt-4 p-3 rounded-lg text-sm font-medium transition-opacity duration-300 hidden"></div>

    <!-- Assignment Detail View (Hidden by default) -->
    <section id="detail-view" class="p-4 bg-background-light dark:bg-background-dark hidden flex-col space-y-4">
        <button id="close-detail" class="text-primary self-start flex items-center text-sm font-medium">
            <span class="material-symbols-outlined text-lg">arrow_back</span> Back to List
        </button>
        <div class="bg-card-light dark:bg-card-dark p-6 rounded-xl shadow-lg space-y-4">
            <h2 id="detail-title" class="text-3xl font-bold text-slate-900 dark:text-white"></h2>
            <div class="flex flex-wrap gap-2 text-sm font-medium">
                <span id="detail-class" class="px-3 py-1 rounded-full bg-slate-200 dark:bg-slate-700 text-slate-800 dark:text-slate-200"></span>
                <span id="detail-priority" class="px-3 py-1 rounded-full text-white"></span>
            </div>
            <p id="detail-due" class="text-lg font-medium text-slate-600 dark:text-slate-300 border-b border-slate-100 dark:border-slate-700 pb-3"></p>
            <div>
                <h3 class="text-sm font-semibold uppercase tracking-wider text-primary mb-2">Description</h3>
                <p id="detail-description" class="text-slate-700 dark:text-slate-200 leading-relaxed italic"></p>
            </div>

            <div class="flex justify-between items-center pt-4 border-t border-slate-100 dark:border-slate-700">
                <label class="flex items-center space-x-3 cursor-pointer">
                    <input id="detail-completed-checkbox" type="checkbox" class="h-5 w-5 rounded border-slate-300 text-primary focus:ring-primary bg-input-light dark:bg-input-dark">
                    <span id="detail-completed-label" class="text-base font-medium">Mark as Complete</span>
                </label>
                <button id="delete-assignment" class="flex items-center text-accent-red hover:text-red-700 transition-colors">
                    <span class="material-symbols-outlined text-xl">delete</span>
                    <span class="text-sm font-medium ml-1">Delete</span>
                </button>
            </div>
        </div>
    </section>

    <!-- Assignment List View -->
    <main id="list-view" class="flex-1 p-4 overflow-y-auto space-y-4">
        <div id="loading-indicator" class="flex justify-center items-center py-8">
            <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-primary" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
            <span>Connecting to storage...</span>
        </div>
        
        <div id="assignment-list" class="space-y-3">
            <!-- Assignment Cards will be injected here -->
        </div>

        <p id="empty-list-message" class="text-center text-slate-500 dark:text-slate-400 p-8 hidden">No assignments match this filter. Try adding one!</p>
    </main>

    <!-- Footer Navigation (Consistent with other pages) -->
    <footer class="bg-card-light dark:bg-slate-800 border-t border-slate-200 dark:border-slate-700 sticky bottom-0 z-10">
        <nav class="flex justify-around p-2">
            <a class="flex flex-col items-center justify-center gap-1 text-slate-500 dark:text-slate-400 hover:text-primary dark:hover:text-primary w-1/4" href="dashboard.html">
                <span class="material-symbols-outlined">home</span>
                <span class="text-xs font-medium">Dashboard</span>
            </a>
            <a class="flex flex-col items-center justify-center gap-1 text-primary w-1/4" href="assignments.html">
                <span class="material-symbols-outlined">list_alt</span>
                <span class="text-xs font-medium">Assignments</span>
            </a>
            <a class="flex flex-col items-center justify-center gap-1 text-slate-500 dark:text-slate-400 hover:text-primary dark:hover:text-primary w-1/4" href="index.html">
                <span class="material-symbols-outlined">calendar_month</span>
                <span class="text-xs font-medium">Calendar</span>
            </a>
            <a class="flex flex-col items-center justify-center gap-1 text-slate-500 dark:text-slate-400 hover:text-primary dark:hover:text-primary w-1/4" href="settings.html">
                <span class="material-symbols-outlined">settings</span>
                <span class="text-xs font-medium">Settings</span>
            </a>
        </nav>
    </footer>

    <!-- Firebase and Application Logic -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInWithCustomToken, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, onSnapshot, query, setLogLevel, doc, updateDoc, deleteDoc, runTransaction } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        setLogLevel('Debug');

        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : null;
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        let db = null;
        let isAuthReady = false;
        let isLocalMode = false;
        const LOCAL_STORAGE_KEY = `academicPlanner_assignments_${appId}`;
        let currentAssignments = [];
        let currentFilter = 'all';

        // UI elements
        const loadingIndicator = document.getElementById('loading-indicator');
        const assignmentList = document.getElementById('assignment-list');
        const emptyListMessage = document.getElementById('empty-list-message');
        const messageBox = document.getElementById('message-box');
        const filterButtons = document.querySelectorAll('.filter-button');
        const listView = document.getElementById('list-view');
        const detailView = document.getElementById('detail-view');
        const detailTitle = document.getElementById('detail-title');
        const detailClass = document.getElementById('detail-class');
        const detailPriority = document.getElementById('detail-priority');
        const detailDue = document.getElementById('detail-due');
        const detailDescription = document.getElementById('detail-description');
        const detailCompletedCheckbox = document.getElementById('detail-completed-checkbox');
        const deleteAssignmentButton = document.getElementById('delete-assignment');
        const closeDetailButton = document.getElementById('close-detail');
        const modal = document.getElementById('confirmation-modal');
        const modalConfirmButton = document.getElementById('modal-confirm');
        const modalCancelButton = document.getElementById('modal-cancel');
        let currentAssignmentId = null;

        // Constants
        const PRIORITY_COLOR_MAP = {
            'High': 'bg-red-500',
            'Medium': 'bg-orange-500',
            'Low': 'bg-slate-500',
        };
        const PRIORITY_ORDER = { 'High': 3, 'Medium': 2, 'Low': 1 };


        /**
         * Utility function to display messages.
         */
        function showMessage(message, type, duration = 3000) {
            let bgColor, textColor;
            switch (type) {
                case 'success':
                    bgColor = 'bg-green-100 dark:bg-green-900';
                    textColor = 'text-green-700 dark:text-green-300';
                    break;
                case 'error':
                    bgColor = 'bg-red-100 dark:bg-red-900';
                    textColor = 'text-red-700 dark:text-red-300';
                    break;
                case 'info':
                    bgColor = 'bg-blue-100 dark:bg-blue-900';
                    textColor = 'text-blue-700 dark:text-blue-300';
                    break;
                default:
                    bgColor = 'bg-gray-100 dark:bg-gray-700';
                    textColor = 'text-gray-800 dark:text-gray-200';
            }

            messageBox.className = `block mx-4 mt-4 p-3 rounded-lg text-sm font-medium transition-opacity duration-300 ${bgColor} ${textColor}`;
            messageBox.innerHTML = message;
            messageBox.classList.remove('hidden');

            if (duration > 0) {
                setTimeout(() => {
                    messageBox.classList.add('opacity-0');
                    setTimeout(() => messageBox.classList.add('hidden', 'opacity-100'), 300);
                }, duration);
            }
        }

        /* --- LOCAL STORAGE FUNCTIONS --- */

        /**
         * Reads all assignments from local storage.
         */
        function getAssignmentsFromLocal() {
            try {
                const data = localStorage.getItem(LOCAL_STORAGE_KEY);
                return data ? JSON.parse(data) : [];
            } catch (error) {
                console.error("Error reading from local storage:", error);
                return [];
            }
        }

        /**
         * Saves the entire assignments array back to local storage.
         */
        function saveAssignmentsToLocal(assignments) {
            try {
                localStorage.setItem(LOCAL_STORAGE_KEY, JSON.stringify(assignments));
            } catch (error) {
                console.error("Error writing to local storage:", error);
                showMessage("Warning: Failed to save changes locally.", "error");
            }
        }
        
        /**
         * Local Mode Realtime Listener (simple manual refresh)
         */
        function startLocalModeListener() {
            loadingIndicator.classList.add('hidden');
            
            // Initial load from local storage
            currentAssignments = getAssignmentsFromLocal();
            renderAssignments();

            // Setup listener for hash changes (for detail view)
            window.addEventListener('hashchange', checkUrlForDetailView);

            // Since we can't do a true snapshot listener, we rely on manual re-renders
            // after every CUD operation and on page load/hash change.
        }

        /**
         * Toggles completion status in Local Mode.
         */
        function toggleCompletionLocal(assignmentId) {
            const index = currentAssignments.findIndex(a => a.id === assignmentId);
            if (index > -1) {
                currentAssignments[index].isCompleted = !currentAssignments[index].isCompleted;
                saveAssignmentsToLocal(currentAssignments);
                showMessage(`Assignment marked as ${currentAssignments[index].isCompleted ? 'Complete' : 'Incomplete'}.`, 'success');
                // Re-render to reflect change
                renderAssignments(); 
                // Render detail view if it's currently open
                if (currentAssignmentId) checkUrlForDetailView();
            }
        }

        /**
         * Deletes an assignment in Local Mode.
         */
        function deleteAssignmentLocal(assignmentId) {
            currentAssignments = currentAssignments.filter(a => a.id !== assignmentId);
            saveAssignmentsToLocal(currentAssignments);
            showMessage('Assignment deleted successfully.', 'success');
            // Re-render and close detail view
            renderAssignments();
            hideDetailView();
        }

        /* --- FIREBASE FUNCTIONS --- */

        /**
         * Returns the Firestore collection path for public assignments.
         */
        function getAssignmentsCollection() {
            if (!db || !isAuthReady) return null;
            return collection(db, `artifacts/${appId}/public/data/assignments`);
        }

        /**
         * Sets up the real-time listener for Firestore assignments.
         */
        function startFirestoreListener() {
            const assignmentsCol = getAssignmentsCollection();
            if (!assignmentsCol) return;

            const q = query(assignmentsCol);

            onSnapshot(q, (snapshot) => {
                loadingIndicator.classList.add('hidden');
                currentAssignments = [];
                snapshot.forEach(doc => {
                    currentAssignments.push({ id: doc.id, ...doc.data() });
                });
                renderAssignments();
                checkUrlForDetailView(); // Check if a detail view needs to be opened/updated
            }, (error) => {
                console.error("Firestore snapshot error:", error);
                showMessage("Error loading data from database.", "error");
            });
            window.addEventListener('hashchange', checkUrlForDetailView);
        }

        /**
         * Toggles completion status in Firestore Mode.
         */
        async function toggleCompletionFirestore(assignmentId, newStatus) {
            const assignmentRef = doc(db, `artifacts/${appId}/public/data/assignments`, assignmentId);
            try {
                await updateDoc(assignmentRef, { isCompleted: newStatus });
                showMessage(`Assignment marked as ${newStatus ? 'Complete' : 'Incomplete'}.`, 'success');
            } catch (error) {
                console.error("Firestore update error:", error);
                showMessage("Failed to update assignment status.", "error");
            }
        }
        
        /**
         * Deletes an assignment in Firestore Mode.
         */
        async function deleteAssignmentFirestore(assignmentId) {
            try {
                const assignmentRef = doc(db, `artifacts/${appId}/public/data/assignments`, assignmentId);
                await deleteDoc(assignmentRef);
                showMessage('Assignment deleted successfully.', 'success');
                hideDetailView();
            } catch (error) {
                console.error("Firestore delete error:", error);
                showMessage("Failed to delete assignment.", "error");
            }
        }

        /* --- CORE RENDERING FUNCTIONS --- */

        /**
         * Filters and sorts the assignments, then calls the render function.
         */
        function renderAssignments() {
            let filteredAssignments = [...currentAssignments];
            
            // 1. Filter
            const now = new Date();
            now.setHours(0, 0, 0, 0);

            if (currentFilter === 'upcoming') {
                filteredAssignments = filteredAssignments.filter(a => !a.isCompleted && new Date(a.dueDate) >= now);
            } else if (currentFilter === 'completed') {
                filteredAssignments = filteredAssignments.filter(a => a.isCompleted);
            } else if (currentFilter === 'all') {
                // If filter is 'all', show completed assignments at the bottom of the list
                filteredAssignments = filteredAssignments.filter(a => !a.isCompleted || a.isCompleted);
            }

            // 2. Sort
            // Sort by priority (desc), then by due date (asc). Completed items are always last.
            filteredAssignments.sort((a, b) => {
                const completedA = a.isCompleted ? 1 : 0;
                const completedB = b.isCompleted ? 1 : 0;

                if (completedA !== completedB) return completedA - completedB; // Completed last

                // Within incomplete/completed groups, sort by Priority then Date
                const priorityA = PRIORITY_ORDER[a.priority] || 1;
                const priorityB = PRIORITY_ORDER[b.priority] || 1;
                if (priorityB !== priorityA) {
                    return priorityB - priorityA; // High priority first
                }
                
                return new Date(a.dueDate) - new Date(b.dueDate); // Earliest due date first
            });

            // 3. Render
            assignmentList.innerHTML = '';
            if (filteredAssignments.length === 0) {
                emptyListMessage.classList.remove('hidden');
            } else {
                emptyListMessage.classList.add('hidden');
                filteredAssignments.forEach(a => assignmentList.appendChild(createAssignmentCard(a)));
            }
        }
        
        /**
         * Creates a clickable card element for an assignment.
         */
        function createAssignmentCard(assignment) {
            const card = document.createElement('div');
            card.className = "flex items-center space-x-3 p-3 bg-card-light dark:bg-card-dark rounded-lg shadow-sm border border-slate-200 dark:border-slate-700 hover:shadow-md transition-shadow cursor-pointer";
            card.setAttribute('data-id', assignment.id);
            card.onclick = () => showDetailView(assignment.id);

            const priorityClass = PRIORITY_COLOR_MAP[assignment.priority] || PRIORITY_COLOR_MAP['Low'];
            const dueDate = new Date(assignment.dueDate).toLocaleDateString(undefined, {
                month: 'short', day: 'numeric', year: 'numeric'
            });
            
            card.innerHTML = `
                <div class="flex-shrink-0">
                    <input type="checkbox" id="checkbox-${assignment.id}" class="task-checkbox h-5 w-5 rounded border-slate-300 text-primary focus:ring-primary bg-input-light dark:bg-input-dark" ${assignment.isCompleted ? 'checked' : ''} onclick="event.stopPropagation(); window.toggleAssignmentCompletion('${assignment.id}', event.target.checked);">
                </div>
                <div class="flex-1 min-w-0">
                    <p class="text-sm font-semibold truncate task-label" id="label-${assignment.id}">${assignment.title}</p>
                    <p class="text-xs text-primary mt-0.5">${assignment.course}</p>
                </div>
                <div class="flex-shrink-0 text-right space-y-1">
                    <span class="text-xs font-medium px-2 py-0.5 rounded-full text-white ${priorityClass}">${assignment.priority || 'Low'}</span>
                    <p class="text-xs text-slate-500 dark:text-slate-400">${dueDate}</p>
                </div>
            `;
            return card;
        }

        /**
         * Public function to toggle assignment completion (called from checkbox onClick).
         */
        window.toggleAssignmentCompletion = function(assignmentId, newStatus) {
            if (isLocalMode) {
                toggleCompletionLocal(assignmentId);
            } else {
                toggleCompletionFirestore(assignmentId, newStatus);
            }
        }
        
        /**
         * Switches the view to show assignment details.
         */
        function showDetailView(id) {
            const assignment = currentAssignments.find(a => a.id === id);
            if (!assignment) {
                showMessage("Assignment not found.", "error");
                return;
            }
            
            // Set current state
            currentAssignmentId = id;
            
            // FIX: Use window.location.hash directly to avoid SecurityError
            window.location.hash = `detail=${id}`;

            // Populate Details
            const priorityClass = PRIORITY_COLOR_MAP[assignment.priority] || PRIORITY_COLOR_MAP['Low'];
            const dueDate = new Date(assignment.dueDate).toLocaleDateString(undefined, {
                weekday: 'long', year: 'numeric', month: 'long', day: 'numeric'
            });

            detailTitle.textContent = assignment.title;
            detailClass.textContent = assignment.course;
            detailPriority.textContent = assignment.priority || 'Low';
            detailPriority.className = `px-3 py-1 rounded-full text-white ${priorityClass}`;
            detailDue.textContent = `Due Date: ${dueDate}`;
            detailDescription.textContent = assignment.description || 'No description provided.';
            detailCompletedCheckbox.checked = assignment.isCompleted;
            detailCompletedCheckbox.onchange = (e) => window.toggleAssignmentCompletion(id, e.target.checked);

            // Show view
            listView.classList.add('hidden');
            detailView.classList.remove('hidden');
        }
        
        /**
         * Switches the view back to the list.
         */
        function hideDetailView() {
            currentAssignmentId = null;
            // FIX: Use window.location.hash directly to clear the hash and avoid SecurityError
            window.location.hash = '';
            
            detailView.classList.add('hidden');
            listView.classList.remove('hidden');
            renderAssignments();
        }
        
        /**
         * Checks the URL hash on load or change to see if the detail view should be opened.
         */
        function checkUrlForDetailView() {
            const hash = window.location.hash.substring(1);
            const params = new URLSearchParams(hash);
            const detailId = params.get('detail');

            if (detailId && currentAssignments.length > 0) {
                // Ensure the assignment exists before trying to display it
                if (currentAssignments.some(a => a.id === detailId)) {
                    showDetailView(detailId);
                } else {
                    // If hash exists but ID is invalid/missing, clear the hash and hide detail view
                    hideDetailView(); 
                }
            } else {
                hideDetailView();
            }
        }


        /* --- INITIALIZATION & EVENT LISTENERS --- */

        /**
         * Initializes Firebase or falls back to Local Mode.
         */
        async function initializeFirebase() {
            if (!firebaseConfig) {
                isLocalMode = true;
                console.warn("Firebase configuration missing. Switching to Local Mode.");
                startLocalModeListener();
                showMessage("Database connection missing. Data loaded from your browser's Local Storage.", "info", 5000);
            } else {
                try {
                    const app = initializeApp(firebaseConfig);
                    db = getFirestore(app);
                    const auth = getAuth(app);
                    
                    if (initialAuthToken) {
                        await signInWithCustomToken(auth, initialAuthToken);
                    } else {
                        await signInAnonymously(auth);
                    }

                    isAuthReady = true;
                    console.log("Firebase initialized and ready. Starting Firestore listener.");
                    startFirestoreListener();
                    
                } catch (error) {
                    console.error("Firebase initialization failed, falling back to Local Mode:", error);
                    isLocalMode = true;
                    isAuthReady = true;
                    startLocalModeListener();
                    showMessage("Database connection failed. Data loaded from Local Storage.", "info", 5000);
                }
            }
        }

        // Global Delete Handler (triggered by modal confirm)
        modalConfirmButton.onclick = () => {
            if (currentAssignmentId) {
                if (isLocalMode) {
                    deleteAssignmentLocal(currentAssignmentId);
                } else {
                    deleteAssignmentFirestore(currentAssignmentId);
                }
            }
            modal.classList.add('hidden');
        };

        // Modal Cancellation
        modalCancelButton.onclick = () => {
            modal.classList.add('hidden');
        };
        
        // Delete button in detail view opens the modal
        deleteAssignmentButton.onclick = () => {
            modal.classList.remove('hidden');
        };

        // Close detail view button
        closeDetailButton.onclick = hideDetailView;

        // Filter button listeners
        filterButtons.forEach(button => {
            button.addEventListener('click', () => {
                // Update active class
                filterButtons.forEach(btn => {
                    btn.classList.remove('bg-primary', 'text-white');
                    btn.classList.add('text-slate-600', 'dark:text-slate-300', 'hover:bg-slate-100', 'dark:hover:bg-slate-700');
                });
                button.classList.add('bg-primary', 'text-white');
                button.classList.remove('text-slate-600', 'dark:text-slate-300', 'hover:bg-slate-100', 'dark:hover:bg-slate-700');
                
                // Update filter and re-render
                currentFilter = button.getAttribute('data-filter');
                renderAssignments();
            });
        });
        
        // Initialize the app on load
        initializeFirebase();

        // Handle Dark Mode preference on load
        if (localStorage.getItem('darkMode') === 'enabled') {
            document.documentElement.classList.add('dark');
        }

    </script>
</body>
</html>
